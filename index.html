<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soft UI – Casino Voucher Generator</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: #ecf0f3; padding: 15px; display: flex; justify-content: center; }
  .container { display: flex; gap: 20px; flex-wrap: wrap; }
  .form-section, .preview-section { background: #ecf0f3; padding: 20px; border-radius: 20px; box-shadow: 7px 7px 15px #c5c7c9, -7px -7px 15px #fff; }
  .form-section { width: 350px; }
  .preview-section { width: 350px; }
  h2 { text-align: center; font-size: 1.3em; margin-bottom: 15px; color: #333; }
  label { display: block; margin: 6px 0 3px; font-size: 0.85em; color: #555; }
  input, select, textarea, button { width: 100%; padding: 10px; border-radius: 12px; border: none; background: #ecf0f3; box-shadow: inset 3px 3px 6px #c5c7c9, inset -3px -3px 6px #fff; font-size: 0.85em; margin-bottom: 10px; color: #333; }
  textarea { height: 300px; resize: none; }
  button { background: linear-gradient(145deg, #56ab2f, #a8e063); box-shadow: 3px 3px 6px #c5c7c9, -3px -3px 6px #fff; color: white; font-weight: bold; cursor: pointer; border: none; transition: transform 0.15s ease, box-shadow 0.15s ease; }
  button:hover { transform: scale(1.05); box-shadow: 4px 4px 8px #b5b7b9, -4px -4px 8px #fff; }
  button:active { transform: scale(0.97); box-shadow: inset 2px 2px 4px #c5c7c9, inset -2px -2px 4px #fff; }
  .stats { background: #ecf0f3; padding: 10px; border-radius: 12px; box-shadow: inset 3px 3px 6px #c5c7c9, inset -3px -3px 6px #fff; font-size: 0.85em; color: #333; margin-bottom: 10px; }
  #bkWarning { font-size: 0.8em; color: red; margin-top: -6px; margin-bottom: 8px; display: none; }
</style>
</head>
<body>
<div class="container">
  <div class="form-section">
    <h2>Voucher Generator</h2>
    <label>Template Type:</label>
    <select id="templateType" onchange="toggleFieldsAndClear()">
      <option value="On Loss">On Loss</option>
      <option value="On Deposit">On Deposit</option>
    </select>
    <label>Currency:</label>
    <select id="currency">
      <option>INR</option><option>BRL</option><option>XOF</option><option>MYR</option><option>ARS</option><option>USD</option><option>XAF</option><option>RUB</option><option>TRY</option><option>AED</option><option>KZT</option><option>AMD</option><option>KES</option><option>CLP</option>
    </select>
    <label for="presetPeriod" id="presetPeriodLabel">Select Period:</label>
    <select id="presetPeriod" onchange="setPresetPeriod()">
      <option value="">Custom</option>
      <option value="lastMonth">Last 1 Month</option>
    </select>
    <label>BK Income Period Start:</label>
    <input type="date" id="startDate">
    <label>BK Income Period End:</label>
    <input type="date" id="endDate">
    <label>Last Voucher Activated:</label>
    <input type="date" id="lastVoucherDate">
    <div id="lossFields">
      <label>Deposit:</label>
      <input type="number" id="deposit" oninput="checkBkIncome()">
      <label>Withdrawal:</label>
      <input type="number" id="withdrawal" oninput="checkBkIncome()">
      <label>BK Income:</label>
      <input type="number" id="bkIncome" oninput="checkBkIncome()">
      <div id="bkWarning">⚠ BK Income is different from Deposit - Withdrawal</div>
    </div>
    <div id="depositFields" style="display:none">
      <label>Deposit:</label>
      <input type="number" id="depositOnly">
    </div>
    <label>System Bonus:</label>
    <input type="number" id="systemBonus">
    <label>Voucher Amount (%):</label>
    <input type="number" id="percentage" value="12">
    <button onclick="generateTemplate()">Generate Template</button>
    <button id="copyBtn" onclick="copyTemplate()">Copy</button>
    <button onclick="countVoucher()">Count Voucher</button>
  </div>
  <div class="preview-section">
    <textarea id="output" readonly></textarea>
    <div class="stats" id="stats">Total Vouchers: 0</div>
    <label>Voucher Provided Amount:</label>
    <input type="number" id="providedAmount">
    <select id="providedCurrency">
      <option>INR</option><option>BRL</option><option>XOF</option><option>MYR</option><option>ARS</option><option>USD</option><option>XAF</option><option>RUB</option><option>TRY</option><option>AED</option><option>KZT</option><option>AMD</option><option>KES</option><option>CLP</option>
    </select>
    <button onclick="countProvidedVoucher()">Count Provided Voucher</button>
    <div class="stats" id="providedStats">Total Provided Vouchers: 0</div>
    <div class="stats" id="combinedStats">Combined Income (Created + Provided):</div>
  </div>
</div>
<script>
let voucherStats = {};
let providedStatsData = {};

function setPresetPeriod() {
  const preset = document.getElementById('presetPeriod').value;
  if (preset === 'lastMonth') {
    const end = new Date();
    const start = new Date();
    start.setMonth(start.getMonth() - 1);
    document.getElementById('startDate').value = start.toISOString().slice(0,10);
    document.getElementById('endDate').value = end.toISOString().slice(0,10);
  }
}

function toggleFieldsAndClear() {
  const type = document.getElementById('templateType').value;

  document.getElementById('lossFields').style.display = (type === 'On Loss') ? 'block' : 'none';
  document.getElementById('depositFields').style.display = (type === 'On Deposit') ? 'block' : 'none';

  // Hide/Show Select Period based on type
  document.getElementById('presetPeriodLabel').style.display = (type === 'On Loss') ? 'block' : 'none';
  document.getElementById('presetPeriod').style.display = (type === 'On Loss') ? 'block' : 'none';

  const startDateField = document.getElementById('startDate');
  const endDateField = document.getElementById('endDate');

  if (type === 'On Loss') {
    startDateField.type = 'date';
    endDateField.type = 'date';
  } else {
    startDateField.type = 'datetime-local';
    endDateField.type = 'datetime-local';
  }

  document.querySelectorAll('#deposit, #withdrawal, #bkIncome, #depositOnly, #systemBonus, #percentage')
    .forEach(el => el.value = '');
  
  startDateField.value = '';
  endDateField.value = '';
}

function checkBkIncome() {
  const deposit = parseFloat(document.getElementById('deposit').value) || 0;
  const withdrawal = parseFloat(document.getElementById('withdrawal').value) || 0;
  const bkIncome = parseFloat(document.getElementById('bkIncome').value) || 0;
  document.getElementById('bkWarning').style.display = Math.abs(bkIncome - (deposit - withdrawal)) > 0.01 ? 'block' : 'none';
}

function formatDate(dateStr) {
  if (!dateStr) return '';
  const [year, month, day] = dateStr.split('-');
  return `${day}-${month}-${year}`;
}

function generateTemplate() {
  const type = document.getElementById('templateType').value;
  const currency = document.getElementById('currency').value;
  const startDate = formatDate(document.getElementById('startDate').value.split('T')[0]);
  const endDate = formatDate(document.getElementById('endDate').value.split('T')[0]);

  let lastVoucherDateValue = document.getElementById('lastVoucherDate').value;
  const lastVoucherDate = lastVoucherDateValue ? formatDate(lastVoucherDateValue) : 'N/A';

  const deposit = type === 'On Loss' ? (parseFloat(document.getElementById('deposit').value) || 0) : (parseFloat(document.getElementById('depositOnly').value) || 0);
  const withdrawal = parseFloat(document.getElementById('withdrawal')?.value) || 0;
  const bkIncome = parseFloat(document.getElementById('bkIncome')?.value) || 0;
  const systemBonus = parseFloat(document.getElementById('systemBonus').value) || 0;
  const percentage = parseFloat(document.getElementById('percentage').value) || 12;

  let voucherAmount = (type === 'On Loss') ? (bkIncome * percentage) / 100 : (deposit * percentage) / 100;
  if (systemBonus >= 1000) voucherAmount = Math.max(0, voucherAmount - systemBonus);

  let template = `Type of Bonus: Manual\nReason for Providing: ${type}\nBK Income Period: [${startDate}] – [${endDate}]\nLast Voucher Activated: [${lastVoucherDate}]\n`;
  if (type === 'On Loss') {
    template += `Deposit: ${deposit} ${currency}\nWithdrawal: ${withdrawal} ${currency}\nBK Income: ${bkIncome} ${currency}\nSystem Bonus: ${systemBonus} ${currency}\nVoucher Amount: ${voucherAmount.toFixed(2)} ${currency}`;
  } else {
    template += `Deposit: ${deposit} ${currency}\nSystem Bonus: ${systemBonus} ${currency}\nVoucher Amount: ${voucherAmount.toFixed(2)} ${currency}`;
  }
  document.getElementById('output').value = template;
}

function copyTemplate() {
  document.getElementById('output').select();
  document.execCommand('copy');
}

function countVoucher() {
  const currency = document.getElementById('currency').value;
  const output = document.getElementById('output').value;
  if (output.trim() === '') return;
  const lastLine = output.split('\n').pop();
  const amount = parseFloat(lastLine.replace(/[^0-9.]/g, '')) || 0;
  if (!voucherStats[currency]) voucherStats[currency] = { count: 0, total: 0 };
  voucherStats[currency].count++;
  voucherStats[currency].total += amount;
  updateStats();
}

function countProvidedVoucher() {
  const currency = document.getElementById('providedCurrency').value;
  const amount = parseFloat(document.getElementById('providedAmount').value) || 0;
  if (!providedStatsData[currency]) providedStatsData[currency] = { count: 0, total: 0 };
  providedStatsData[currency].count++;
  providedStatsData[currency].total += amount;
  updateStats();
}

function updateStats() {
  let createdStatsHTML = Object.entries(voucherStats).map(([cur, data]) => `(${cur}) Total Vouchers: ${data.count}, Total Amount: ${data.total.toFixed(2)} ${cur}`).join('<br>');
  let providedStatsHTML = Object.entries(providedStatsData).map(([cur, data]) => `(${cur}) Total Provided Vouchers: ${data.count}, Total Provided Amount: ${data.total.toFixed(2)} ${cur}`).join('<br>');
  let combinedHTML = Object.keys({...voucherStats, ...providedStatsData}).map(cur => {
    const createdTotal = voucherStats[cur]?.total || 0;
    const providedTotal = providedStatsData[cur]?.total || 0;
    return `(${cur}) Combined Income: ${(createdTotal + providedTotal).toFixed(2)} ${cur}`;
  }).join('<br>');

  document.getElementById('stats').innerHTML = createdStatsHTML || 'Total Vouchers: 0';
  document.getElementById('providedStats').innerHTML = providedStatsHTML || 'Total Provided Vouchers: 0';
  document.getElementById('combinedStats').innerHTML = combinedHTML || 'Combined Income (Created + Provided): 0';
}
</script>
</body>
</html>
